<%= render :partial => "left_panel" %>
<div style="float: left;width: 75%;border-left: 1px solid black;padding-left: 10px;">
  <h1>Your messages</h1>
  <hr></hr>
  <% unless current_user.received_messages.blank? %>
    <table width="100%" style="text-align: center;" cellpadding="5" cellspacing="5">
      <tr>
        <th style="width:5%;">
          From
        </th>
        <th style="width:50%;">
          Message
        </th>
        <th style="width:5%;">
          Date
        </th>
        <th style="width:35%;">
          Response
        </th>
        <th style="width:5%;">
          Delete
        </th>
      </tr>
      <% current_user.received_messages.each do |message| %>
        <tr style="font-weight: <%= message.is_read ? "normal" : "bold"  %>;">
          <td style="font-size: 12px;width:5%;">
            <%= message.sender.first_name %>
          </td>

          <td style="font-size: 12px;text-align: left;width:50%;">
            <%= link_to h(message.message_type == "Inquiry" ? message.body[0..54] : message.subject), view_message_path(current_user, message), :style => "text-decoration:none;" %>
          </td>

          <td style="font-size: 12px;width:5%;">
            <%= message.created_at.strftime("%B/%d/%Y") %>
          </td>

          <td style="text-align: center;width:35%;">
            <% unless message.message_type == "Inquiry" %>
              <span id="drop_down_<%=message.id%>_<%= message.locations_user_id %>" style="display: block;width: auto;text-align: center;height: 28px;">
                <%= select_tag "request_status_#{message.id}_#{message.locations_user_id}",
                  options_for_select([["PENDING" , LocationsUser::PENDING ],
                    ["ACCEPTED" , LocationsUser::ACCEPTED],
                    ["REJECTED" , LocationsUser::REJECTED],
                    ["ENDED" , LocationsUser::ENDED]], message.locations_user.status.to_i),
                  :style => "border: 1px solid #AFAFAF;height: 26px;line-height: 26px;width: 100px;" %>
              </span>
              <span id="updated_request_msg_div_<%=message.id%>_<%= message.locations_user_id %>" style="display: none;color: darkcyan;font-size:11px;width: auto;text-align: center;height: 28px;">
                Request Updated
              </span>
              <%= observe_field( "request_status_#{message.id}_#{message.locations_user_id}", :on => :changed,
                :url => update_request_status_path(message.id),
                :with => "request_status_#{message.id}_#{message.locations_user_id}",
                :success => "setTimeout('hide_updated_msg(#{message.id},#{message.locations_user_id})', 2500);" )
            %>
              <script type="text/javascript">
                function hide_updated_msg(message_id,locations_user_id){
                  jQuery('#updated_request_msg_div_'+message_id+'_'+locations_user_id).animate({ opacity: 'hide' }, "slow");
                  jQuery('#drop_down_'+message_id+'_'+locations_user_id).animate({ opacity: 'show' }, "slow");
                }
              </script>
            <% else %>
              <%= link_to "Reply Inquiry", view_message_path(current_user, message), :style => "text-decoration:none;" %>
            <% end %>
          </td>

          <td style="width:5%;">
            <%= link_to "x", message_delete_path(@user,message.id), :confirm => "Are you sure you want to delete this message?", :style => "text-decoration:none;" %>
          </td>
        </tr>
      <% end %>

    </table>

  <% else %>
    <div style="font-weight: bold;font-style: italic;">
      Your Inbox is empty at the moment.
    </div>
  <% end %>

</div>

